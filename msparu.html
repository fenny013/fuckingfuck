<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>MSPAru Proxy</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            background: #f0f0f0;
            color: #222;
        }

        #content {
            min-height: 100%;
            background: #fff;
            padding: 1em;
            box-sizing: border-box;
        }

        a {
            color: #0044cc;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<div id="content">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const s = params.get("s");
    const p = params.get("p");

    const proxies = [
        url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
        url => `https://cors-proxy.htmldriven.com/?url=${encodeURIComponent(url)}`,
        url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`
    ];

    if (!s || !p) {
        document.getElementById("content").textContent = "–î–æ–±–∞–≤—å ?s=6&p=005139 –≤ –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É!";
    } else {
        const targetURL = `https://mspaintadventures.ru/?s=${s}&p=${p}`;
        let currentProxy = 0;

        function tryNextProxy() {
            if (currentProxy >= proxies.length) {
                document.getElementById("content").textContent = "üòø –í—Å–µ –ø—Ä–æ–∫—Å–∏ —Å–¥–æ—Ö–ª–∏ –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã.";
                return;
            }

            const proxyURL = proxies[currentProxy](targetURL);
            fetch(proxyURL)
                .then(response => {
                    if (!response.ok) throw new Error("HTTP error " + response.status);
                    return response.text();
                })
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, "text/html");
                    const tbody = doc.querySelector("tbody");

                    if (tbody) {
                        // –ß–∏–Ω–∏–º –∫–∞—Ä—Ç–∏–Ω–∫–∏
                        tbody.querySelectorAll("img").forEach(img => {
                            const originalSrc = img.getAttribute("src");
                            if (originalSrc && !originalSrc.startsWith("http")) {
                                img.src = "https://mspaintadventures.ru/" + originalSrc.replace(/^\/+/, '');
                            }
                        });

                        // –ß–∏–Ω–∏–º —Å—Å—ã–ª–∫–∏
                        tbody.querySelectorAll("a").forEach(a => {
                            const href = a.getAttribute("href");
                            if (href && href.startsWith("?s=")) {
                                const currentPage = location.pathname.split('/').pop(); // –∏–º—è —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, msparu.html)
                                a.setAttribute("href", `${currentPage}${href}`);
                            }
                        });

                        document.getElementById("content").innerHTML = tbody.outerHTML;
                    } else {
                        document.getElementById("content").textContent = "tbody –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.";
                    }
                })
                .catch(error => {
                    console.warn("–û—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏ #" + (currentProxy + 1), error);
                    currentProxy++;
                    tryNextProxy();
                });
        }

        tryNextProxy();
    }
</script>
</body>
</html>
